---
title: US foreign aid since 1980
author: Samal Abdikerimova, Ravi Donepudi, Carlos Salinas, and Xiran Yu
date: "`r format(Sys.time(), '/%d/%m/%Y/')`"
---

```{r setup, include = FALSE}
library("tidyr")
library("tidyverse")
library("gganimate")
```

We will analyze foreign aid data since 1980s and look for any relationships between GDP and the top donors and the sorts of purposes/projects they are most willing to donate to.


First we import the data and filter out any donation made prior to 1980. We do this as follows
```{r}
donation_data <- read_csv("1_Data/aiddata-countries-only.csv") %>%
    rename(commitment = commitment_amount_usd_constant,
           purpose = coalesced_purpose_name,
           p_code = coalesced_purpose_code)
donations_since_1980 <- donation_data %>% filter(year >= 1980)
```

The following plot shows the top six donors since 1980 and their total donations over the years.

```{r}
top_6_donors <-
    filter(donations_since_1980,
           donor %in% (donations_since_1980 %>%
                       group_by(donor) %>%
                       summarize(total_aid = sum(commitment)) %>%
                       arrange(desc(total_aid)) %>%
                       slice(1:6) %>%
                       pull(donor)))

top_6_donors %>%
    group_by(donor,year) %>%
    summarize(total_aid = sum(commitment)) %>%
    ungroup() %>%
    ggplot() +
    geom_smooth(se=FALSE,
                mapping = aes(x = year, y = total_aid, color = donor))
```

Next we look what purpose these countries donated the most to
```{r}
group_by(donor,purpose) %>%
    summarize(total_p = sum(commitment)) %>%
    ungroup()
```

The following plot shows the aid the United States has given to foreign countries since 1980.
```{r, eval=TRUE, warning=FALSE, message=FALSE}
df_usa %>%
    group_by(year) %>%
    filter(commitment_amount_usd_constant > (5 * 10 ^6)) %>%
    summarize(total_aid = sum(commitment_amount_usd_constant)) %>%
    ungroup() %>%
    ggplot() +
    geom_smooth(se=FALSE, mapping = aes(x = year, y = total_aid)) +
    labs(title="Total aid to foreign countries since 1980",
         y="Total aid from the US in USD")
```

As one can see, the total amount of funding has been decreasing since 1996 with a minimum occurring at 2008, likely due to the recession.

Next we focus on the top 10 countries to receive the most aid from the United States. We do this by running the following commands.
```{r, eval=TRUE, eval=TRUE, warning=FALSE, message=FALSE}
top_countries <- df_usa %>%
    group_by(recipient) %>%
    summarize(total_aid = sum(commitment_amount_usd_constant)) %>%
    arrange(desc(total_aid)) %>%
    slice(1:10)
countries <- top_countries$recipient
```
If we plot the top 10 countries we see that there are two notable spikes one in the early 1990s for Kuwait and one in the late 1990s for Saudi Arabia. This is due to the Iranian Gulf War for the former and the 1998 Saudi Arabian War.
```{r, eval=TRUE, eval=TRUE, warning=FALSE, message=FALSE}
df_usa %>%
    filter(recipient %in% countries) %>%
    group_by(year,recipient) %>%
    summarize(total_aid = sum(commitment_amount_usd_constant)) %>%
    ungroup() %>%
    ggplot(aes(x = year, y = total_aid, color = recipient)) +
    geom_line() +
    labs(title="Top 10 recipients of US aid",
         y="Total aid from the US in USD")
```

Why are we donating so much to Kuwait and Saudi Arabia in the 90s? Let's find out.

```{r}
top_6_donor_names <- df %>%
    group_by(donor) %>%
    summarize(total_aid = sum (commitment_amount_usd_constant)) %>%
    arrange(desc(total_aid)) %>%
    slice(1:6)

top_6_donors <- df %>% filter(donor %in% top_10_donor_names$donor)
```

```{r}

```
